
/*

This is a basic set-up for a Node server-side app running GlueServer.

*/

/* basic Node set-up */

var express = require('express');
var app = express();

var http = require('http').Server(app);
var io = require('socket.io')(http);

var socket = io();


/* glueJS requires sha1 */

var sha1 = require('sha1');


/* initialise a GlueServer object */

var GlueServer = require('glueserver');

glue = new GlueServer();
glue.sha1 = sha1;
glue.init();


/* register some system-wide allowed functions */

glue.registerAllowedFunction('graphNodeAdd', 'general');
glue.registerAllowedFunction('graphNodeDelete', 'general');
glue.registerAllowedFunction('customAlert', 'general');


/* register some system-wide allowed objects */

glue.registerAllowedObject('displayAssets-TV', false);
glue.registerAllowedObject('displayAssets-Controller', false);


/* create blank objects for the new allowed objects */

glue.updateObject('displayAssets-TV', {});
glue.updateObject('displayAssets-Controller', {});


/* give glue a socket to communicate with */

io.on('connection', function(socket) {

  socket.on('glue message', function(msg) {
    glue.signalHandler(msg, io, socket);
  });

});
